#!/usr/local/bin/pike

import Stdio;

#include "types.h"

int main(int argc, string *argv)
{	
  program output=(program)argv[1];
  werror("Reading ");
  mixed data=stdin->read(0x7fffffff);
  werror("Lexing ");
  data=Sgml.lex(data);
  werror("Grouping ");
  data=Sgml.group(data);
  werror("Including ");
  data=Wmml.handle_include(data);
  werror("Verifying\n");
  Wmml.verify(data);
  werror("Collecting TOC ");
  SGML toc=Wmml.collect_toc(data);
  werror("index ");
  INDEX_DATA index=Wmml.collect_index(data);
  // write(sprintf("%O\n",Wmml.group_index(Wmml.collect_index(data))));
  werror("\nWriting output\n");
  output()->output(argv[2],data,toc,index);
  write("Ok\n");
  exit(0);
}
