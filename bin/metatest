#!/bin/sh

SRCPATH=`dirname $0`
SRCPATH=`dirname $SRCPATH`

case $SRCPATH in
  /*) ;;
  *) SRCPATH=`pwd`/$SRCPATH ;;
esac

set -e
set -x

docompile4() {
  mkdir test1
  cd test1
  $SRCPATH/src/configure --cache-file ../testcache
  d="DEBUGDEF=$1"
  make "$d"
  make verify "$d"
  make verify LPCOPTS=-d2 "$d"
#  make verify LPCOPTS=-d99 "$d"
  cd ..
  rm -rf test1
}

docompile3() {
  docompile4 "$1"
  docompile4 "$1 -DFLAT_MAPPINGS"
  docompile4 "$1 -DOLD_MAPPINGS"
}

docompile2() {
  docompile3 "$1 -DDEBUG"
  docompile3 "$1"
}

docompile1() {
  docompile2 "$1 -DALWAYS_GC"
  docompile2 "$1 -DNO_GC"
  docompile2 "$1"
}


docompile1
rm testcache
