#!/bin/sh

SRCPATH=`dirname $0`
SRCPATH=`dirname $SRCPATH`

case $SRCPATH in
  /*) ;;
  *) SRCPATH=`pwd`/$SRCPATH ;;
esac

set -e
set -x

docompile() {
  mkdir test1
  cd test1
  $SRCPATH/src/configure --cache-file ../testcache
  make "$1"
  make verify "$1"
  make verify LPCOPTS=-d2 "$1"
  cd ..
  rm -rf test1
}

docompile2() {
  docompile DEBUGDEF="$1 -DDEBUG"
  docompile DEBUGDEF="$1"
}

docompile3() {
  docompile2 "$1 -DALWAYS_GC"
  docompile2 "$1 -DNO_GC"
  docompile2 "$1"
}

docompile3
rm testcache
