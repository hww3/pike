#!/bin/sh

# Stupid IRIX cpp turns --- into -- -
sed -e 's/^# \([0-9]* "[^"]*"\).*$/#line \1/;s/^# \([0-9]*\).*$/#line \1/;t
: loop
/OPCODE[0-9]/!b keepnl
s/ -- \{0,1\}- / ½ /g;t loop
h;s/^[^½]*\(OPCODE[0-9][^½]*\) ½.*$/\1¤/p;t more
N;b loop
: more
g;s/^[^½]*OPCODE[0-9][^½]* ½\(.*\)$/\1/;b loop
: keepnl
s/.//g' | sed -e ': loop
/¤$/{N;s/¤\n//;b loop
};/^[ 	]*$/{H;d;};/^#line/{h;d;};x;s/^\
//;p;s/.//g;x'
