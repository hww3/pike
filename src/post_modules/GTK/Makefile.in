# This line is needed on some machines.
@make_variables@
VPATH=@srcdir@:@srcdir@/../..:../..:.
MODNAME=GTK
DEST=@prefix@/lib/pike/modules/
OBJS=dummy.o
MODULE_LDFLAGS=@LDFLAGS@ @LIBS@ @DATABOX_LIBS@ @PGTK_LIBS@ @GNOME_LIBS@ @LIBGLADE_LIBS@
MODULE_CFLAGS=@PGTK_CFLAGS@ @GNOME_CFLAGS@ @LIBGLADE_CFLAGS@
CONFIG_HEADERS=config.h
MODULE_CLEAN_EXTRA=p*.c

# WITH_GTK == 2
#   override -> compile2 -> compile1 -> [SET OBJS] -> all
#
# WITH_GTK == 1
#   override -> compile1 -> [SET OBJS] -> all
#
# WITH_GTK == 0
#   override -> compile0 -> all
#

MYRUNPIKE=../../pike -DNOT_INSTALLED -m../../master.pike

override:  compile@WITH_GTK@
	@:

@dynamic_module_makefile@

compile0:
	@echo "Pike-GTK disabled."
	$(MAKE) all

docs:  doc@WITH_GTK@

doc0:
	@echo "Pike-GTK disabled."


doc1:
	$(RUNPIKE) $(SRCDIR)/new_build_pgtk.pike --source='$(SRCDIR)/source/'\
                   $(SRCDIR)/output/doc-pikeref.pike

compile1:
	$(RUNPIKE) $(SRCDIR)/new_build_pgtk.pike --source='$(SRCDIR)/source/'\
                   $(SRCDIR)/output/few.pike
	@$(MAKE) OBJS="`cat files_to_compile`" \
               CFLAGS="`echo $(CFLAGS) | sed -e 's/-g//g' -e 's/-W[^ ]*//g'`" \
                  all

compile2: compile1
#
# Many machines have problems compiling this file with full optimization.
# They should not have that any longer  /Per
#
#pgtk.o: pgtk.c Makefile
#	@echo "Compiling $< with less optimization" ;\
#	if $(CC) $(NOOPT_CFLAGS) -c $< -o $@ ; then : ;\
#	else \
#	  echo "WARNING: Compiler failure! Trying without optimization!" >&2;\
#	  echo "echo $(CC) $(NOOPT_CFLAGS) -c $< -o $@" >&2;\
#	  NO_ULIMIT=yes $(CC) $(NOOPT_CFLAGS) -c $< -o $@ ;\
#	fi

options: config.status
	./config.status 

# Some hand-made dependencies:

$(OBJS) : pgtk.h \
 $(SRCDIR)/../../global.h \
 $(SRCDIR)/../../svalue.h \
 $(SRCDIR)/../../program.h \
 $(SRCDIR)/../../pike_types.h \
 $(SRCDIR)/../../interpret.h \
 $(SRCDIR)/../../module_support.h \
 $(SRCDIR)/../../pike_error.h \
 $(SRCDIR)/../../array.h \
 $(SRCDIR)/../../backend.h \
 $(SRCDIR)/../../stralloc.h \
 $(SRCDIR)/../../mapping.h \
 $(SRCDIR)/../../object.h \
 $(SRCDIR)/../../threads.h \
 $(SRCDIR)/../../operators.h
