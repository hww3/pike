#test Image.image->polyfill 3 (hollow stars)
   object img=Image.Image(100,100,0,0,0);
   int i;

   array a=({}),b=({});
   foreach (({0,1,2,3,4}),i)
   {
      a+=({ 50+50*sin(i*2*3.1415926535/5+0.11),
	    50+50*cos(i*2*3.1415926535/5+0.11) });
      a+=({ 50+19*sin((i+0.5)*2*3.1415926535/5+0.11),
	    50+19*cos((i+0.5)*2*3.1415926535/5+0.11) });
      b+=({ 50+19*sin(i*2*3.1415926535/5+0.1),
	    50+19*cos(i*2*3.1415926535/5+0.1) });
      b+=({ 50+0.5*5*sin((i+0.5)*2*3.1415926535/5+0.1),
	    50+0.5*5*cos((i+0.5)*2*3.1415926535/5+0.1) });
   }

   img->setcolor(128,0,16);
   img->polyfill(a,b);

   a=({}),b=({});
   foreach (({0,1,2,3,4,5,6}),i)
   {
      a+=({ 50+50*sin(i*2*3.1415926535/7+0.11),
	    50+50*cos(i*2*3.1415926535/7+0.11) });
      a+=({ 50+19*sin((i+0.5)*2*3.1415926535/7+0.11),
	    50+19*cos((i+0.5)*2*3.1415926535/7+0.11) });
      b+=({ 50+0.9*50*sin(i*2*3.1415926535/7+0.11),
	    50+0.9*50*cos(i*2*3.1415926535/7+0.11) });
      b+=({ 50+0.5*19*sin((i+0.5)*2*3.1415926535/7+0.11),
	    50+0.5*19*cos((i+0.5)*2*3.1415926535/7+0.11) });
   }

   img->setcolor(255,128,0);
   img->polyfill(a,b);

   object img1=Image.GIF.decode(MIME.decode_base64(
      "R0lGODlhZABkAPcAAAAAAAEAAAIBAAQAAAIAAAMBAAUAAAQCAAUCAAMAAAcAAAgAAQYAAAcDAAkAAQsAAQwAAQsBAAoAAQkEAAoFAAsFAAwGAAgEAA0AAQ4AAQ8AARAAAhIAAhMAAhADABEAAhQAAhUAAhYAAhgAAxoAAxsAAw0GAA8HABEIABAIABEJABIJABMKAA4HABcAAhcIABUKABQKABYLABcLABkMABgMABoNABsNABwAAx0AAx4AAx8AAx0EASAABCEABCIABCQABCUABCYAAyQCAiYABCcABCgABSkABSsABSoABSwABS4ABS8ABTAABjEABjIABjAEBDMABjUABjcABjgABzcCBTYABjkABzoABzsABz0ABz4ABxwOAB0OAB4PAB0PAB8PACAQACEQACIRACMRACQSACcPACYTACcTACUSACgUACkUACkVACsWACoVACwWAC0WAC0XADEPAS4XAC8XADEYADIZADkHBDMaADUaADcbADYbADodADgcADweAD0eAEMACEQLBUkACE4ACU8ACFcAClkACmAACmAAC2gADGkADHAADXUADncADnkADnwAD0IXAUEfAEMhAEolAEokAFAnAFgnAFksAFcpAF4vAHQVB3QeBGEwAGYyAGkzAHY3AEoACX4AD38ADn8AD4AAEIAAD4EBD4ICD4MDD4MEDoUFD4cIDYoLDosKDosIDo4NDpEQDZMUDJYVDZkZDJsdC58fDKEgC6QgC6cnCqkpCqAvBqwrCq0yCLMyCbQzCLg3CHY7AH1AAH9BAIhFAI1IAJRKAJpGAp5QAHk8AKxLArw9B79GBapWALNbAL5bAb9hAMdHBs1NBs9RBNVWBNJTBM1kANtcBOJjAtBpANhsANpuAOFwAOhpAuptAeZzAOt2AadTAO9vAfBxAfByAfB4AO92APF5APNzAfN0AfV2AfF3APN6APN5APV6APd4APh5APd8APh7APl6APp7APl9APt8APp9APt+APx9APx+AP1+AP1/AO93AP5/AP5+AP+AACwAAAAAZABkAAcI/wABABA4cGBBgwYRJky4kCFDhw8fRpQokWLFihcxYtS4cWNHjx5Bhgw5kqTEACZNplSpkiXGA5datpQ5c6ZKZMBs2tS5c2dCN/Ay+fQ5lKjJAtX+SZIowajRhC2etgQG79+ch0EASZW6x9PW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"));

   
   if (!(img-img1<16)) fail("differ too much");
//    known failure
//    if (!equal(img->max(),({255,128,16}))) 
//       fail("wrong maxcolor ("+img->max()[0]+","+img->max()[1]+","+img->max()[2]+")");
   ok();


#test Image.image->polyfill 4 (star)
   int i;
   array a=({});
   foreach (({0,1,2,3,4}),i)
   {
      a+=({ 50+50*sin(i*2*3.1415926535/5+0.11),
	    50+50*cos(i*2*3.1415926535/5+0.11) });
      a+=({ 50+20*sin((i+0.5)*2*3.1415926535/5+0.11),
	    50+20*cos((i+0.5)*2*3.1415926535/5+0.11) });
   }

   object img=Image.Image(100,100,0,0,0);
   img->setcolor(128,0,16);
   img->polyfill(a);

   object img1=Image.GIF.decode(MIME.decode_base64(
"R0lGODlhZABkAOYAAAAAAAIAAAEAAAQAAAUAAAYAAAMAAAgAAQkAAQoAAQsAAQwAAQ0AAQ4AAQ8AAQcAABAAAhEAAhIAAhMAAhUAAhQAAhYAAhcAAhgAAxkAAxoAAxsAAxwAAx0AAx4AAx8AAyAABCEABCIABCMABCQABCUABCYABCcABCgABSkABSoABSsABSwABS0ABS4ABS8ABTAABjEABjIABjMABjQABjUABjYABjcABjgABzkABzoABzsABzwABz0ABz4ABz8AB0AACEMACEIACEYACEcACEgACUkACUoACUsACUwACU0ACU4ACU8ACVAAClIAClEAClMAClUAClgAC1cAClkAC1YAClsAC1wAC10AC14AC18AC2AADGEADGIADGMADGQADGUADGYADGcADGgADWkADWoADWsADWwADW0ADW4ADW8ADXAADnEADnMADnQADnUADnIADncADngAD3kAD3YADnoAD3sAD3wAD0EACH0AD38AD34AD4AAEAAAAAAAAAAAACwAAAAAZABkAAYH/4AAAIKDg4WGhoiJiYuMjI6Pj5GSkpSVlZeYmJqbm52enqChoaOkpKanp6mqqqytra+wsLKzs7W2tri5ubu8hgq+vsHClSpFxMTIxDl6NMnJz7YCRnx8HNDQ2KoEUtV6BdnZ4Z4KX9V8aOLi6pUTaud8UeukKC3zsx508Hw9954HdcKI8EdqxZ19fEoQ3ISEj54rFxZW2qEHIZ8GEitRqMhnzxMHGQcJaGiRTshKWeDdGXJAIgEqFqtlOSnpBMI4Owb4UxAmZrUhNB8JeIeQzQsB6yoQ9eki6CMdPsmQyPYhjs9zEZ0mAnhViwZiLQ5e5XMngFZGSsbqgRKBFw+OY//FnGVkAa7PO0USwBo5Fh6TuYy09K0mpweBUwWsDD6HA3AiFIurwZGBdNMCMZGrgXBsSMCazHzMnMBE4XNmPS05D9oBuhqXa4xAyGm9RrUhBHZaO6wywZALsaCl2Da0RHe1PEgU+LCbGc/wQReYg85jvFqK54O2VK9+ri12Fdy5z8E+KACb8Ma5kB/EA73uI+sBJMjtPrOM+ACY1M/8NT4G6ftZtIdO+HURYF9l4DfICgeOBYWCAAQAR4M+7QAhAD1QGNN1ECYAnIbn1MGDARA2AaJFZ4yg4H8nIqRHFSDF50WLFtXRA4nYdTAbjRahMdVwItTBo096SAGBaid8OKT/RXb8QOBZLVC3ZF9pmHDWDHtMGRkV3p3EjJaZ2QHEkwv9ACCYY6kx2kJDoFmdFRLcw5eb1d0hxGHZBOAEneitwSExBnTDp3tX9OYLAVgMut8dQeA5ywMGKhogGyrMkkBPkjaYRQWqMFBGpvXdgcYVSOigggWnQJAGqK3p0UYXT+ABwwcNVAZLBROyetUcY0hBhA0lUECmLxi8oes5eaiRhRI8sLCBXv5wYFWmaUARhAwhQGDWSSHMwaqVZ5lAX6Z6IHDWClJyZ8caX1ChhBA2nFGdGWfFkGVfetSRhhdTIAFEDSl4IMEDkrxQ3RJa3QCXHnKgwUUVR/wwAwocROCo1ioBmNZaDE5F0IMMJmzgwLDJ1GAcpxfOMoAbrZmUsi2sgUbFy7YUMG1kPNBsCx6gfaCzpUIulgfJP4dCRGRfFD0LA0r6RITSs6Q1WKVQtyLBvVfpwUDVsEDRlxpcwxLdWE6EDQtMV9VgdisdnFkNBmu3ol1Mc9gadygj+ITF3a2AERMQfKuSQkwqBn6KGQjtQbDhpBi8zxiMnxLAUtUgEfkpJsPT1OWhrAzPkZyHEjMfbYROis3VVGE6KTzzkcPqoSAgJGywb0KEHTjWjgkDM+nuCQVzBQIAOw=="));

   if (!(img-img1<16)) fail("differ too much");
   if (!equal(img->max(),({128,0,16}))) 
      fail("wrong maxcolor ("+img->max()[0]+","+img->max()[1]+","+img->max()[2]+")");
   ok();
