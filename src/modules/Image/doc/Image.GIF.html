<title>Pike documentation: module Image.GIF</title>
<h2>module Image.GIF</h2>


<blockquote>
This submodule keep the GIF encode/decode capabilities
     of the <tt><a href=Image.html>Image</a></tt> module.

<p>     GIF is a common image storage format,
     usable for a limited color palette - a GIF image can 
     only contain as most 256 colors - and animations.

<p>     Simple encoding:
     <tt><a href=Image.GIF.html#encode>encode</a></tt>, <tt><a href=Image.GIF.html#encode_trans>encode_trans</a></tt>

<p>     Advanced stuff:
     <tt><a href=Image.GIF.html#render_block>render_block</a></tt>, <tt><a href=Image.GIF.html#header_block>header_block</a></tt>,
     <tt><a href=Image.GIF.html#end_block>end_block</a></tt>, <tt><a href=Image.GIF.html#netscape_loop_block>netscape_loop_block</a></tt>

<p>     Very advanced stuff:
     <tt><a href=Image.GIF.html#_render_block>_render_block</a></tt>, <tt><a href=Image.GIF.html#_gce_block>_gce_block</a></tt>
</blockquote>


<h4>SEE ALSO</h4>
<blockquote>     <tt><a href=Image.html>Image</a></tt>,
     <tt><a href=Image.image.html>Image.image</a></tt>,
     <tt><a href=Image.colortable.html>Image.colortable</a></tt>
</blockquote>

<hr>
<a name=_gce_block> </a>
<h4>SYNOPSIS</h4>
<blockquote>
<tt>string <b>_gce_block</b>(int&nbsp;transparency, int&nbsp;transparency_index, int&nbsp;delay, int&nbsp;user_input, int&nbsp;disposal);</tt>
</blockquote>

<h4>DESCRIPTION</h4>


<blockquote>
This function gives back a Graphic Control Extension block.
     A GCE block has the scope of the following render block.
</blockquote>
<h4>ARGUMENTS</h4>
<blockquote><dl>
<dt><tt>int transparency</tt>
<dt><tt>int transparency_index</tt>
  <dd>The following image has transparency, marked with this index.
<dt><tt>int delay</tt>
  <dd>View the following rendering for this many centiseconds (0..65535).
<dt><tt>int user_input</tt>
  <dd>Wait the delay or until user input. If delay is zero,
     wait indefinitely for user input. May sound the bell
     upon decoding.
<dt><tt>int disposal</tt>
  <dd>Disposal method number;
     <dl compact>
     <dt>0<dd>No disposal specified. The decoder is
              not required to take any action.
     <dt>1<dd>Do not dispose. The graphic is to be left
              in place.
     <dt>2<dd>Restore to background color. The area used by the
              graphic must be restored to the background color.
     <dt>3<dd>Restore to previous. The decoder is required to
              restore the area overwritten by the graphic with
              what was there prior to rendering the graphic.
     <dt compact>4-7<dd>To be defined.
     </dl>
</dl></blockquote>


<h4>NOTE</h4>
<blockquote>
This is in the very advanced sector of the GIF support;
     please read about how GIFs file works.

<p>     Most decoders just ignore some or all of these parameters.
</blockquote>


<h4>SEE ALSO</h4>
<blockquote>     <tt><a href=Image.GIF.html#_render_block>_render_block</a></tt>,
     <tt><a href=Image.GIF.html#render_block>render_block</a></tt>
</blockquote>

<hr>
<a name=_render_block> </a>
<h4>SYNOPSIS</h4>
<blockquote>
<tt>string <b>_render_block</b>(int&nbsp;x, int&nbsp;y, int&nbsp;xsize, int&nbsp;ysize, int&nbsp;bpp, string&nbsp;indices, 0|string&nbsp;colortable, int&nbsp;interlace);</tt>
</blockquote>

<h4>DESCRIPTION</h4>


<blockquote>
Advanced (!) method for writing renderblocks for placement
     in a GIF file. This method only applies LZW encoding on the
     indices and makes the correct headers.
</blockquote>
<h4>ARGUMENTS</h4>
<blockquote><dl>
<dt><tt>int x</tt>
<dt><tt>int y</tt>
  <dd>Position of this image.
<dt><tt>int xsize</tt>
<dt><tt>int ysize</tt>
  <dd>Size of the image. Length if the <tt>indices</tt> string
     must be xsize*ysize.
<dt><tt>int bpp</tt>
  <dd>Bits per pixels in the indices. Valid range 1..8.
<dt><tt>string indices</tt>
  <dd>The image indices as an 8bit indices.
<dt><tt>string colortable</tt>
  <dd>Colortable with colors to write as palette.
     If this argument is zero, no local colortable is written.
     Colortable string len must be 1<<bpp.
<dt><tt>int interlace</tt>
  <dd>Interlace index data and set interlace bit. The given string
     should _not_ be pre-interlaced.
</dl></blockquote>


<h4>NOTE</h4>
<blockquote>
This is in the very advanced sector of the GIF support;
     please read about how GIFs file works.
</blockquote>


<h4>SEE ALSO</h4>
<blockquote>     <tt><a href=Image.GIF.html#encode>encode</a></tt>,
     <tt><a href=Image.GIF.html#_encode>_encode</a></tt>,
     <tt><a href=Image.GIF.html#header_block>header_block</a></tt>,
     <tt><a href=Image.GIF.html#end_block>end_block</a></tt>
</blockquote>

<hr>
<a name=encode> </a>
<a name=encode_trans> </a>
<h4>SYNOPSIS</h4>
<blockquote>
<tt>string <b>encode</b>(object&nbsp;img);<br>
string <b>encode</b>(object&nbsp;img, int&nbsp;colors);<br>
string <b>encode</b>(object&nbsp;img, object&nbsp;colortable);<br>
string <b>encode_trans</b>(object&nbsp;img, object&nbsp;alpha);<br>
string <b>encode_trans</b>(object&nbsp;img, int&nbsp;tr_r, int&nbsp;tr_g, int&nbsp;tr_b);<br>
string <b>encode_trans</b>(object&nbsp;img, int&nbsp;colors, object&nbsp;alpha);<br>
string <b>encode_trans</b>(object&nbsp;img, int&nbsp;colors, int&nbsp;tr_r, int&nbsp;tr_g, int&nbsp;tr_b);<br>
string <b>encode_trans</b>(object&nbsp;img, int&nbsp;colors, object&nbsp;alpha, int&nbsp;tr_r, int&nbsp;tr_g, int&nbsp;tr_b);<br>
string <b>encode_trans</b>(object&nbsp;img, object&nbsp;colortable, object&nbsp;alpha);<br>
string <b>encode_trans</b>(object&nbsp;img, object&nbsp;colortable, int&nbsp;tr_r, int&nbsp;tr_g, int&nbsp;tr_b);<br>
string <b>encode_trans</b>(object&nbsp;img, object&nbsp;colortable, object&nbsp;alpha, int&nbsp;a_r, int&nbsp;a_g, int&nbsp;a_b);<br>
string <b>encode_trans</b>(object&nbsp;img, object&nbsp;colortable, int&nbsp;transp_index);</tt>
</blockquote>

<h4>DESCRIPTION</h4>


<blockquote>
Create a complete GIF file.

<p>     The latter (<tt><a href=Image.GIF.html#encode_trans>encode_trans</a></tt>) functions 
     add transparency capabilities.

<p>     Example:
     <pre>
     img=<tt><a href=Image.image.html>Image.image</a></tt>([...]);
     [...] // make your very-nice image
     write(<tt><a href=Image.GIF.encode.html>Image.GIF.encode</a></tt>(img)); // write it as GIF on stdout 
     </pre>
</blockquote>
<h4>ARGUMENTS</h4>
<blockquote><dl>
<dt><tt>object img</tt>
  <dd>The image which to encode.
<dt><tt>int colors</tt>
<dt><tt>object colortable</tt>
  <dd>These arguments decides what colors the image should
     be encoded with. If a number is given, a colortable
     with be created with (at most) that amount of colors.
     Default is '256' (GIF maximum amount of colors).
<dt><tt>object alpha</tt>
  <dd>Alpha channel image (defining what is transparent); black
     color indicates transparency. GIF has only transparent
     or nontransparent (no real alpha channel).
     You can always dither a transparency channel:
     <tt>Image.colortable(my_alpha, ({({0,0,0}),({255,255,255})}))<wbr>
         ->full()<wbr>->floyd_steinberg()<wbr>->map(my_alpha)</tt>
<dt><tt>int tr_r</tt>
<dt><tt>int tr_g</tt>
<dt><tt>int tr_b</tt>
  <dd>Use this (or the color closest to this) color as transparent
     pixels.
<dt><tt>int a_r</tt>
<dt><tt>int a_g</tt>
<dt><tt>int a_b</tt>
  <dd>Encode transparent pixels (given by alpha channel image) 
     to have this color. This option is for making GIFs for 
     the decoders that doesn't support transparency.
<dt><tt>int transp_index</tt>
  <dd>Use this color no in the colortable as transparent color.
</dl></blockquote>


<h4>NOTE</h4>
<blockquote>
For advanced users:
     <pre>Image.GIF.encode_trans(img,colortable,alpha);</pre>
     is equivalent of using
     <pre>Image.GIF.header_block(img->xsize(),img->ysize(),colortable)+
     Image.GIF.render_block(img,colortable,0,0,0,alpha)+
     Image.GIF.end_block();</pre>
     and is actually implemented that way.
</blockquote>

<hr>
<a name=end_block> </a>
<h4>SYNOPSIS</h4>
<blockquote>
<tt>string <b>end_block</b>();</tt>
</blockquote>

<h4>DESCRIPTION</h4>


<blockquote>
This function gives back a GIF end (trailer) block.
</blockquote>
<h4>RETURNS</h4>


<blockquote>
the end block as a string.
</blockquote>


<h4>NOTE</h4>
<blockquote>
This is in the advanced sector of the GIF support;
     please read some about how GIFs are packed.

<p>     The result of this function is always ";" or "\x3b",
     but I recommend using this function anyway for code clearity.
</blockquote>


<h4>SEE ALSO</h4>
<blockquote>     <tt><a href=Image.GIF.html#header_block>header_block</a></tt>,
     <tt><a href=Image.GIF.html#end_block>end_block</a></tt>
</blockquote>

<hr>
<a name=header_block> </a>
<h4>SYNOPSIS</h4>
<blockquote>
<tt>string <b>header_block</b>(int&nbsp;xsize, int&nbsp;ysize, int&nbsp;numcolors);<br>
string <b>header_block</b>(int&nbsp;xsize, int&nbsp;ysize, object&nbsp;colortable);<br>
string <b>header_block</b>(int&nbsp;xsize, int&nbsp;ysize, object&nbsp;colortable, int&nbsp;background_color_index, int&nbsp;gif87a, int&nbsp;aspectx, int&nbsp;aspecty);<br>
string <b>header_block</b>(int&nbsp;xsize, int&nbsp;ysize, object&nbsp;colortable, int&nbsp;background_color_index, int&nbsp;gif87a, int&nbsp;aspectx, int&nbsp;aspecty, int&nbsp;r, int&nbsp;g, int&nbsp;b);</tt>
</blockquote>

<h4>DESCRIPTION</h4>


<blockquote>
This function gives back a GIF header block.

<p>     Giving a colortable to this function includes a 
     global palette in the header block.
</blockquote>
<h4>ARGUMENTS</h4>
<blockquote><dl>
<dt><tt>int xsize</tt>
<dt><tt>int ysize</tt>
  <dd>Size of drawing area. Usually same size as in
     the first (or only) render block(s).
<dt><tt>int background_color_index</tt>
  <dd>This color in the palette is the background color.
     Background is visible if the following render block(s)
     doesn't fill the drawing area or are transparent.
     Most decoders doesn't use this value, though.
<dt><tt>int gif87a</tt>
  <dd>If set, write 'GIF87a' instead of 'GIF89a' (default 0 == 89a).
<dt><tt>int aspectx</tt>
<dt><tt>int aspecty</tt>
  <dd>Aspect ratio of pixels,
     ranging from 4:1 to 1:4 in increments
     of 1/16th. Ignored by most decoders. 
     If any of <tt>aspectx</tt> or <tt>aspecty</tt> is zero,
     aspectratio information is skipped.
<dt><tt>int r</tt>
<dt><tt>int g</tt>
<dt><tt>int b</tt>
  <dd>Add this color as the transparent color.
     This is the color used as transparency color in
     case of alpha-channel given as image object. 
     This increases (!) the number of colors by one.
</dl></blockquote>
<h4>RETURNS</h4>


<blockquote>
the created header block as a string
</blockquote>


<h4>NOTE</h4>
<blockquote>
This is in the advanced sector of the GIF support;
     please read some about how GIFs are packed.

<p>     This GIF encoder doesn't support different size
     of colors in global palette and color resolution.
</blockquote>


<h4>SEE ALSO</h4>
<blockquote>     <tt><a href=Image.GIF.html#header_block>header_block</a></tt>,
     <tt><a href=Image.GIF.html#end_block>end_block</a></tt>
</blockquote>

<hr>
<a name=netscape_loop_block> </a>
<h4>SYNOPSIS</h4>
<blockquote>
<tt>string <b>netscape_loop_block</b>();<br>
string <b>netscape_loop_block</b>(int&nbsp;number_of_loops);</tt>
</blockquote>

<h4>DESCRIPTION</h4>


<blockquote>
Creates a application-specific extention block;
     this block makes netscape and compatible browsers
     loop the animation a certain amount of times.
</blockquote>
<h4>ARGUMENTS</h4>
<blockquote><dl>
<dt><tt>int number_of_loops</tt>
  <dd>Number of loops. Max and default is 65535.
</dl></blockquote>

<hr>
<a name=render_block> </a>
<h4>SYNOPSIS</h4>
<blockquote>
<tt>string <b>render_block</b>(object&nbsp;img, object&nbsp;colortable, int&nbsp;x, int&nbsp;y, int&nbsp;localpalette);<br>
string <b>render_block</b>(object&nbsp;img, object&nbsp;colortable, int&nbsp;x, int&nbsp;y, int&nbsp;localpalette, object&nbsp;alpha);<br>
string <b>render_block</b>(object&nbsp;img, object&nbsp;colortable, int&nbsp;x, int&nbsp;y, int&nbsp;localpalette, object&nbsp;alpha, int&nbsp;r, int&nbsp;g, int&nbsp;b);<br>
string <b>render_block</b>(object&nbsp;img, object&nbsp;colortable, int&nbsp;x, int&nbsp;y, int&nbsp;localpalette, int&nbsp;delay, int&nbsp;transp_index, int&nbsp;interlace, int&nbsp;user_input, int&nbsp;disposal);<br>
string <b>render_block</b>(object&nbsp;img, object&nbsp;colortable, int&nbsp;x, int&nbsp;y, int&nbsp;localpalette, object&nbsp;alpha, int&nbsp;r, int&nbsp;g, int&nbsp;b, int&nbsp;delay, int&nbsp;interlace, int&nbsp;user_input, int&nbsp;disposal);</tt>
</blockquote>

<h4>DESCRIPTION</h4>


<blockquote>
This function gives a image block for placement in a GIF file,
     with or without transparency.
     The some options actually gives two blocks, 
     the first with graphic control extensions for such things
     as delay or transparency.

<p>     Example:
     <pre>
     img1=<tt><a href=Image.image.html>Image.image</a></tt>([...]);
     img2=<tt><a href=Image.image.html>Image.image</a></tt>([...]);
     [...] // make your very-nice images
     nct=<tt><a href=Image.colortable.html>Image.colortable</a></tt>([...]); // make a nice colortable
     write(<tt><a href=Image.GIF.header_block.html>Image.GIF.header_block</a></tt>(xsize,ysize,nct)); // write a GIF header
     write(<tt><a href=Image.GIF.render_block.html>Image.GIF.render_block</a></tt>(img1,nct,0,0,0,10)); // write a render block
     write(<tt><a href=Image.GIF.render_block.html>Image.GIF.render_block</a></tt>(img2,nct,0,0,0,10)); // write a render block
     [...]
     write(<tt><a href=Image.GIF.end_block.html>Image.GIF.end_block</a></tt>()); // write end block
     // voila! A GIF animation on stdout.
     </pre>
</blockquote>
<h4>ARGUMENTS</h4>
<blockquote><dl>
<dt><tt>object img</tt>
  <dd>The image.
<dt><tt>object colortable</tt>
  <dd>Colortable with colors to use and to write as palette.
<dt><tt>int x</tt>
<dt><tt>int y</tt>
  <dd>Position of this image.
<dt><tt>int localpalette</tt>
  <dd>If set, writes a local palette.
<dt><tt>object alpha</tt>
  <dd>Alpha channel image; black is transparent.
<dt><tt>int r</tt>
<dt><tt>int g</tt>
<dt><tt>int b</tt>
  <dd>Color of transparent pixels. Not all decoders understands
     transparency. This is ignored if localpalette isn't set.
<dt><tt>int delay</tt>
  <dd>View this image for this many centiseconds. Default is zero.
<dt><tt>int transp_index</tt>
  <dd>Index of the transparent color in the colortable.
     <tt>-1</tt> indicates no transparency.
<dt><tt>int user_input</tt>
  <dd>If set: wait the delay or until user input. If delay is zero,
     wait indefinitely for user input. May sound the bell
     upon decoding. Default is non-set.
<dt><tt>int disposal</tt>
  <dd>Disposal method number;
     <dl compact>
     <dt>0<dd>No disposal specified. The decoder is
              not required to take any action. (default)
     <dt>1<dd>Do not dispose. The graphic is to be left
              in place.
     <dt>2<dd>Restore to background color. The area used by the
              graphic must be restored to the background color.
     <dt>3<dd>Restore to previous. The decoder is required to
              restore the area overwritten by the graphic with
              what was there prior to rendering the graphic.
     <dt compact>4-7<dd>To be defined.
     </dl>
</dl></blockquote>


<h4>NOTE</h4>
<blockquote>
This is in the advanced sector of the GIF support;
     please read some about how GIFs are packed.

<p>     The user_input and disposal method are unsupported
     in most decoders.
</blockquote>


<h4>SEE ALSO</h4>
<blockquote>     <tt><a href=Image.GIF.html#encode>encode</a></tt>,
     <tt><a href=Image.GIF.html#header_block>header_block</a></tt>,
     <tt><a href=Image.GIF.html#end_block>end_block</a></tt>
</blockquote>
