AC_INIT(freetype.c)
AC_CONFIG_HEADER(config.h)
AC_ARG_WITH(freetype,     [  --with(out)-freetype       Support Freetype via Freetype 2 (Image.FreeType)],[],[with_freetype=yes])

AC_MODULE_INIT()

PIKE_FEATURE_WITHOUT(_Image_FreeType,Image.FreeType.....)

if test "x$with_freetype" = "xyes" ; then

  PIKE_FEATURE_NODEP(_Image_FreeType,Image.FreeType.....)

  AC_PATH_PROG(FT_CONFIG, freetype-config, no)

  if test "$FT_CONFIG" = "no" ; then
     :
  else
    OLDCFLAGS="$CFLAGS"
    OLDLIBS="$LIBS"
    CFLAGS="$CFLAGS `$FT_CONFIG --cflags`"
    LIBS="$LIBS `$FT_CONFIG --libs`"
    AC_MSG_CHECKING(If freetype actually works)
    AC_TRY_LINK([
#include <freetype/freetype.h> 
], 
[
  FT_Library library;
  FT_Init_FreeType( &library );
], 
[ft_ok=yes], 
[ft_ok=no])
    if test yes = "$ft_ok" ; then
      AC_MSG_RESULT(yes)
      AC_DEFINE(HAVE_LIBFT2)
      PIKE_FEATURE_OK(_Image_FreeType,Image.FreeType.....)
    else
      AC_MSG_RESULT(no)
      CFLAGS="$OLDCFLAGS"
      LIBS="$OLDLIBS"
    fi
  fi
fi

AC_OUTPUT(Makefile,echo FOO >stamp-h )
