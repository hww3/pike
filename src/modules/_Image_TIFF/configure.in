#
# $Id: configure.in,v 1.7 2002/08/20 16:45:28 grubba Exp $
#
AC_INIT(image_tiff.c)
AC_CONFIG_HEADER(config.h)
AC_ARG_WITH(tifflib,     [  --with(out)-tifflib       Support TIFF (Image.TIFF)],[],[with_tifflib=yes])

AC_MODULE_INIT()

PIKE_FEATURE_WITHOUT(Image.TIFF)

if test x$with_tifflib = xyes ; then
  PIKE_FEATURE_NODEP(Image.TIFF)

  AC_CHECK_HEADERS(tiff.h tiffio.h tiffiop.h)
  if test $ac_cv_header_tiff_h = yes ; then
    AC_MSG_CHECKING([if this tifflib is working])
    AC_CACHE_VAL(pike_cv_working_tiff, [
      AC_EGREP_CPP(42, [
#include <tiff.h>
TIFF_VERSION
      ], [ pike_cv_working_tiff=no ], [ pike_cv_working_tiff=yes ])
    ])
    if test "x$pike_cv_working_tiff" = "xno"; then
      AC_MSG_RESULT([no])
      PIKE_FEATURE([Image.TIFF],[no (tifflib version 42)])
    else
      AC_MSG_RESULT([yes])
      AC_CHECK_LIB(tiff, main, [
  	AC_DEFINE(HAVE_LIBTIFF) 
  	LIBS="${LIBS-} -ltiff"
  	PIKE_FEATURE_OK(Image.TIFF)
       ],[])
      AC_CHECK_LIB(jpeg, main, [
  	LIBS="${LIBS-} -ljpeg"
       ],[])
      AC_CHECK_LIB(z, main, [
  	LIBS="${LIBS-} -lz"
       ],[])
    fi
  fi
fi

AC_OUTPUT(Makefile,echo FOO >stamp-h )


